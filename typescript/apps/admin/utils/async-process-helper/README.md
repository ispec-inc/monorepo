# 背景
- 非同期処理を行う際に、APIの応答を待っている間画面にローディング中であることを示す表示を出すことが多い。
  - この表示を行うか否かを制御するために`boolean`型の変数を用いるが、これをAPIとの疎通開始時/終了時に操作する処理を毎回書かなくてはならない。
  - 特にAPIとの疎通終了時にローディング表示制御変数を`false`にする処理が漏れてしまいがちであるため、これを解消したい。
- また、APIとの疎通時にエラーが発生した際にその表示を行うため、エラーメッセージ用の変数も同様に用意する必要があることも多い。
  - これもAPIとの疎通開始時に毎回値をリセットする必要があり、変数の用意/操作をAPIと疎通する箇所の多くで行わなくてはならないため、これも仕組み化したい。

# 目的
- 「APIのレスポンスを待っている状態か否かを表す変数」「エラーメッセージを表す変数」の定義〜制御を外部のモジュールへまとめて移譲し隠蔽することで、実際にAPIとの疎通処理を行っている部分のコードをよりシンプルにする。

# 利用方法
```typescript
// AsyncProcessHelperをインスタンス化する際に渡す引数である、`実際に非同期処理を行う関数(Promiseを返す関数)`には`.bind(/* その関数が定義されているインスタンス */)`をつける
const asyncFn = this.fetchData.bind(this)

// AsyncProcessHelperのインスタンス化
// メソッドチェーンで非同期処理の成功時、失敗時などの処理を定義することができる
const helper = new AsyncProcessHelper(asyncFn)
  .onSuccess((res, setError) => {
    // 対象の非同期関数が問題なく解決された際に呼ばれる(`Promise.then()`に相当)
    // 第二引数の`setError`は文字列を引数にとる関数で、渡された文字列をエラーメッセージとしてインスタンス内の変数へ保存する
    // onFailure、onCompleteの`setError`も同様
  })
  .onFailure((err, setError) => {
    // 対象の非同期関数を実行している際に例外が発生した際に呼ばれる(`Promise.catch()`に相当)
  })
  .onComplete((setError) => {
    // 対象の非同期関数の処理が完了した際に呼ばれる(`Promise.finally()`に相当)
  })

// AsyncProcessHelperをインスタンス化する際に渡した非同期処理を実際に走らせる
// 渡した非同期処理を行う関数に引数があった場合は、この`run()`で同様の引数を要求するようになる
// この際、インスタンス内の「API疎通待ち表示変数」「エラーメッセージ表示変数」はそれぞれ自動で更新される
helper.run()

// API疎通待ちかどうかを示す
// helper.run()実行時にtureになり、非同期処理が終わった際に自動でfalseになる
helper.isAwaitingResponse

// インスタンス内に保存されているエラーメッセージを示す
// 先述のように、各ハンドラーでこの値を更新することができる
// helper.run()実行時にnullへリセットされる
helper.errorMessage

// エラーメッセージが設定された際にイベントを発行するRxJSのSubject<string>
// エラーメッセージ変数にnullが入った際はイベントは発行されない
helper.errorMessageStream
```

# 備考
- `Service`層での利用を想定しています
